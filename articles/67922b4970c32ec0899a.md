---
title: "denopsã§vimã®codicæ‹¡å¼µæ©Ÿèƒ½ã‚’æ›¸ã„ãŸ"
emoji: "ğŸœ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["denops", "deno", "vim"]
published: false
---


# denopsã§vimã®codicæ‹¡å¼µæ©Ÿèƒ½ã‚’æ›¸ã„ãŸ

denopsã§[codic](https://codic.jp)ã®æ‹¡å¼µæ©Ÿèƒ½ã‚’æ›¸ãã¾ã—ãŸã€‚
[Omochice/dps-codic-vim: The codic plugin of vim.](https://github.com/Omochice/dps-codic-vim)

![](https://storage.googleapis.com/zenn-user-upload/ucr6abmlq1fmmvdvn6ff62ag04vs)

## èƒŒæ™¯

æ™®æ®µãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’æ›¸ã„ã¦ã„ã‚‹ã¨ãã«é›‘ã«`get`ã¨ã‹ã‚’é›‘ã«ä½¿ã„ãŒã¡ãªã®ã§ã¡ã‚ƒã‚“ã¨ã—ãŸå‘½åã‚’ã—ãŸã„ã®ã§Codicã‚’ä½¿ã£ã¦ã¾ã™ã€‚
(Googleç¿»è¨³ã¨ã‹ã ã¨ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§ã‚ˆãä½¿ã†å˜èªã¨è‹¥å¹²é•ã†ã®ãŒã§ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒã‚ã‚‹)
ã„ã¡ã„ã¡ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‹ã„ã¦èª¿ã¹ã‚‹ã®ã¯æ‰‹é–“ãªã®ã§ã‚¨ãƒ‡ã‚£ã‚¿ã‹ã‚‰APIã‚’å©ã‘ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚

ã‚ã¨ã¯vimã®æ‹¡å¼µæ©Ÿèƒ½ãŒdenoã§æ›ã‘ã‚‹ã‚ˆã†ã«ãªã£ãŸã‚‰ã—ã„ã®ã§å‹‰å¼·ãŒã¦ã‚‰æ›¸ããŸã‹ã£ãŸã®ã‚‚ã‚ã‚Šã¾ã™ã€‚


ä½œã£ã¦ã„ã‚‹æœ€ä¸­ã«èª¿ã¹ãŸã‚‰æ—¢ã«å…ˆäººãŒä½œã£ã¦ã„ã‚‰ã£ã—ã‚ƒã£ãŸã€‚

- https://github.com/koron/codic-vim

å¤šåˆ†ã“ã£ã¡ã®ã»ã†ãŒé«˜æ€§èƒ½ã§ã™ã€‚


## å®Ÿè£…

[vim-denops/denops.vim: ğŸœ An ecosystem of Vim/Neovim which allows developers to write plugins in Deno](https://github.com/vim-denops/denops.vim)
ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚

APIã‹ã‚‰ã®çµæœã‚’è¡¨ç¤ºã™ã‚‹ã ã‘ãªã®ã§80è¡Œç¨‹åº¦ã§æ›¸ã‘ã¾ã—ãŸã€‚

```typescript
mport { start } from "https://deno.land/x/denops_std@v0.4/mod.ts";

async function fetchAPI(text: string[], TOKEN: any): Promise<any> {
  const BASEURL = "https://api.codic.jp/v1/engine/translate.json";
  const res = await fetch(BASEURL, {
    headers: new Headers({
      "Authorization": `Bearer ${TOKEN}`,
    }),
    body: new URLSearchParams({
      "text": text.join("\n"),
    }),
    method: "POST",
  });
  if (res.status !== 200) {
    console.log(res.status);
  }
  const json = res.json();
  const data = await json;
  return data;
}

start(async (vim) => {
  vim.register({
    async codic(args: unknown): Promise<void> {
      if (typeof args !== "string") {
        throw new Error(`'args' must be a string`);
      }
      const TOKEN = Deno.env.get("CODIC_TOKEN");
      if (TOKEN === "") {
        throw new Error(`No token set`);
      }

      // console.log(`your token is ${TOKEN}`);
      const targets = args.split(/\s+/);

      const data = await fetchAPI(targets, TOKEN);

      let contents: string[] = [];
      for (let datum of data) {
        contents.push(`${datum["text"]} -> ${datum["translated_text"]} `);
        for (let word of datum["words"]) {
          let content = `  - ${word["text"]}: `;
          if (word["successful"]) {
            for (let candidate of word["candidates"]) {
              content += `${candidate["text"]}, `;
            }
          } else {
            content += "null";
          }
          contents.push(content);
        }
        contents.push("");
      }
      await vim.cmd("bo new");

      await vim.call(
        "setline",
        1,
        contents,
      );
      await vim.execute(`
        setlocal bufhidden=wipe buftype=nofile
        setlocal nobackup noswapfile
        setlocal nomodified nomodifiable
      `);
    },
  });

  vim.execute(`
    command! -nargs=? -bar Codic call denops#request('${vim.name}', 'codic', [<q-args>])
  `);
});
```


APIã‚’å©ããŸã‚ã«ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã€`Deno.env.get()`ã§`$CODIC_TOKEN`ã‚’å–å¾—ã—ã¦ã„ã¾ã™ã€‚
(ç’°å¢ƒå¤‰æ•°ã®å–å¾—ã¯`vim.eval("$CODIC_TOKEN")`ã§ã‚‚ã§ãã‚‹ã‚ˆã†ã§ã™ã€‚)
vimå†…ã®å¤‰æ•°ã§`let g:codic_accesstoken`ã¨ã‹ã§ã‚‚ã„ã„ã‹ã¨æ€ã„ã¾ã—ãŸãŒvimrcã‚’dotfilesã§ç®¡ç†ã—ã¦ã„ãŸã‚Šã™ã‚‹ã¨é¢å€’ãªã®ã§ç’°å¢ƒå¤‰æ•°ã‹ã‚‰ã®èª­ã¿è¾¼ã¿ã«ã—ã¾ã—ãŸã€‚

`:Codic <text>`ã§ä¸ãˆã‚‰ã‚ŒãŸ`text`ã‚’`/\s+/`ã§åˆ†å‰²ã—ã¦`\n`ã§çµåˆã—ã¦APIã‚’å©ã„ã¦ã„ã¾ã™ã€‚
APIå´ã®åˆ¶é™ã§1åº¦ã«å¤‰æ›ã§ãã‚‹ã®ã¯3ã¤ã¾ã§ã§ã™ã€‚
(ã“ã“ã®éƒ¨åˆ†ã®ã‚¨ãƒ©ãƒ¼å‡¦ç†ã‚’ã¾ã ã‹ã‘ã¦ã„ãªã„)


## ä»Šå¾Œå®Ÿè£…ã™ã‚‹äºˆå®šã®æ©Ÿèƒ½

- é¸æŠç¯„å›²ã®å¤‰æ›
ã€€- é¸æŠç¯„å›²ã®ç½®æ›ã‚’ã™ã‚‹ã®ã§camelCaseã ã£ãŸã‚Šsnake_caseã‚’é¸ã¹ã‚‹ã‚ˆã†ã«ã™ã‚‹


### å‚è€ƒã«ã•ã›ã¦ã„ãŸã ã„ãŸè¨˜äº‹

- [denops.vimã§æ‹¬å¼§è£œå®Œãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’æ›¸ã„ãŸ](https://zenn.dev/higashi000/articles/d1efa3676ceca46fc357)
- [Deno ã‚’ä½¿ã£ã¦ Vim/Neovim ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’æ›¸ã by denops.vim](https://zenn.dev/lambdalisue/articles/b4a31fba0b1ce95104c9) 

